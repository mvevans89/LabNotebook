<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <link rel="stylesheet" type="text/css" href="/public/css/font-awesome/css/font-awesome.css">
	<link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Drake Lab Blog &middot; This is our lab blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
 
  <!-- Icons -->
	<link rel="shortcut icon" href="/_site/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-boom">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Drake Lab Blog
        </a>
      </h1>
      <p class="lead">We are a group of population and disease ecologists in the Odum School of Ecology at University of Georgia.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item active" href="/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/archive/">Archive</a>
          
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="/labpage/">Lab website</a>
          
        
      
        
          
        
      
    </nav>

    <p>&copy; 2015. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/02/24/double-well/">
        Animating the double well potential
      </a>
    </h1>

    <span class="post-date">24 Feb 2015</span>

    <p>I recently found myself wanting an animation of fluctuations in a double well potential to use in a presentation. The double well potential is a mathematical object from statistical physics -- the classical &quot;ball-and-cups&quot; diagram -- but it&#39;s useful for thinking about bistable systems in general. It turns out, this was quite easy to do using the <code>animation</code> package in R.</p>

<p>To start, I searched for a simple formula to serve as the potential function and discovered the <a href="http://physics.ucsc.edu/%7Epeter/115/duffing.pdf">Duffing equation</a>, which was previously unfamiliar to me. The equation, $V(x) = -x^2/2 + x^4/4$, is plotted below using the following code snippet.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">duffing <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="o">-</span>x<span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="m">2</span> <span class="o">+</span> x<span class="o">^</span><span class="m">4</span><span class="o">/</span><span class="m">4</span>
xi <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span> length<span class="o">=</span><span class="m">100</span><span class="p">)</span>
y <span class="o">&lt;-</span> duffing<span class="p">(</span>xi<span class="p">)</span>
plot<span class="p">(</span>xi<span class="p">,</span> y<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&#39;V(x)&#39;</span><span class="p">)</span></code></pre></div>

<p><img src="/../figs/double-well/duffing.png" alt="center"> </p>

<p>For my illustration, I wanted the potential barrier (the hump in the middle) to be higher and for the potential function itself to be asymmetric. I modified the original equation by multiplying the first term by a constant and adding a third term that is linear in $x$, yielding $W(x) = -2(x^2/2) + x^4/4 + ax = - x^2 + x^4/4 + ax$. My function, with $a=0.1$, looks like this.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">W <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> a<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="m">-2</span><span class="o">*</span><span class="p">(</span>x<span class="o">^</span><span class="m">2</span><span class="o">/</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> x<span class="o">^</span><span class="m">4</span><span class="o">/</span><span class="m">4</span> <span class="o">+</span> a<span class="o">*</span>x
xi <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span> length<span class="o">=</span><span class="m">100</span><span class="p">)</span>
y <span class="o">&lt;-</span>W<span class="p">(</span>xi<span class="p">,</span> a<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
plot<span class="p">(</span>xi<span class="p">,</span> y<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">2</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&#39;W(x)&#39;</span><span class="p">)</span></code></pre></div>

<p><img src="/../figs/double-well/potential.png" alt="center"> </p>

<p>To simulate the dynamics of a particle subject to this potential we need to differentiate $W$ and take the negative, yielding $w = 2x - x^3 -a$.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">w <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> a<span class="o">=</span><span class="m">0</span><span class="p">)</span> <span class="m">2</span><span class="o">*</span>x <span class="o">-</span> x<span class="o">^</span><span class="m">3</span> <span class="o">-</span> a</code></pre></div>

<p>Next we write a function to solve for the fluctuations using <a href="http://en.wikipedia.org/wiki/Euler%E2%80%93Maruyama_method">Euler&#39;s method</a> for <a href="http://en.wikipedia.org/wiki/Stochastic_differential_equation">stochastic differential equations</a>. Here the standard deviation is arbitrarily set to 0.5 and the time scale is determined by setting $\tau=1$.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">euler <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x0<span class="p">,</span> a<span class="o">=</span><span class="m">0</span><span class="p">,</span> tau<span class="o">=</span><span class="m">1</span><span class="p">,</span> sigma<span class="o">=</span><span class="m">0.5</span><span class="p">){</span>
  <span class="kr">return</span><span class="p">(</span>x0 <span class="o">+</span> w<span class="p">(</span>x0<span class="p">,</span> a<span class="p">)</span><span class="o">*</span>tau <span class="o">+</span> sigma<span class="o">*</span>rnorm<span class="p">(</span><span class="m">1</span><span class="p">,</span> mean<span class="o">=</span><span class="m">0</span><span class="p">,</span> sd<span class="o">=</span><span class="kp">sqrt</span><span class="p">(</span>tau<span class="p">)))</span>
<span class="p">}</span></code></pre></div>

<p>Now we write a function that can produce an animation through repeated plotting. As written, the function doesn&#39;t require any arguments (relevant constants are set in the first five lines of the function). A loop is used to produce 1000 plots, each of which consists of two panels. The top panel is a picture of the potential function with the position of the particle indicated by a point. The bottom panel is a time series showing the last 100 positions. Time is shown on the $y$-axis so that the position of the particle in the two graphs can be aligned.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">animate <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(){</span>
  a <span class="o">&lt;-</span> <span class="m">0.1</span>
  xi <span class="o">&lt;-</span> <span class="kp">seq</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span> length<span class="o">=</span><span class="m">100</span><span class="p">)</span>
  y <span class="o">&lt;-</span>W<span class="p">(</span>xi<span class="p">,</span> a<span class="o">=</span>a<span class="p">)</span>
  x <span class="o">&lt;-</span> <span class="m">1</span>
  t <span class="o">&lt;-</span> <span class="m">0</span>
  <span class="kr">for</span><span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">1000</span><span class="p">){</span>
    layout<span class="p">(</span><span class="kt">matrix</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">),</span> nrow<span class="o">=</span><span class="m">4</span><span class="p">,</span> ncol<span class="o">=</span><span class="m">1</span><span class="p">,</span> byrow <span class="o">=</span> <span class="kc">TRUE</span><span class="p">))</span>
    par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
    plot<span class="p">(</span>xi<span class="p">,</span>W<span class="p">(</span>xi<span class="p">,</span> a<span class="o">=</span>a<span class="p">),</span> type<span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> lwd<span class="o">=</span><span class="m">4</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> axes<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
    box<span class="p">()</span>
    
    <span class="kp">t</span><span class="p">[</span>i<span class="m">+1</span><span class="p">]</span> <span class="o">&lt;-</span> i
    x<span class="p">[</span>i<span class="m">+1</span><span class="p">]</span> <span class="o">&lt;-</span> euler<span class="p">(</span><span class="kp">tail</span><span class="p">(</span>x<span class="p">,</span><span class="m">1</span><span class="p">),</span> a<span class="o">=</span>a<span class="p">,</span> tau<span class="o">=</span><span class="m">0.1</span><span class="p">)</span>
    points<span class="p">(</span>x<span class="p">[</span>i<span class="m">+1</span><span class="p">],</span> W<span class="p">(</span>x<span class="p">[</span>i<span class="m">+1</span><span class="p">],</span>a<span class="p">)</span><span class="m">+0.1</span><span class="p">,</span> cex<span class="o">=</span><span class="m">3</span><span class="p">,</span> pch<span class="o">=</span><span class="m">21</span><span class="p">,</span> bg<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
    
    par<span class="p">(</span>mar<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
    plot<span class="p">(</span><span class="kp">tail</span><span class="p">(</span>x<span class="p">,</span><span class="m">100</span><span class="p">),</span> <span class="kp">tail</span><span class="p">(</span><span class="kp">t</span><span class="p">,</span><span class="m">100</span><span class="p">),</span> type<span class="o">=</span><span class="s">&#39;l&#39;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> ylab<span class="o">=</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">-2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Finally, this function is called within a code chunk using the <code>animation</code> package to produce the individual frames (as bitmap images) and stitch them together.</p>

<video   controls="controls" loop="loop"><source src="/../figs/double-well/animation.ogg" />video of chunk animation</video>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/02/10/parasiteR/">
        Accessing online helminth data through R
      </a>
    </h1>

    <span class="post-date">10 Feb 2015</span>

    <h2>The Problem</h2>

<p>Data are everywhere, right? There are repositories like <a href="http://datadryad.org/">Dryad</a>, and more journals are implementing open-data policies. However, some databases don&#39;t have a <code>download</code> button, and getting the data off the browser and into R can be a pain. However, these data may contribute to the development and testing of general ecological theory. For the longest time, I thought that the extraction of these online data would require another set of tools separate from <code>R</code>. This is not the case.</p>

<h2>The solution</h2>

<p>Thankfully, there are some very smart people designing ways to use R to extract information from webpages. I will focus on <a href="https://github.com/hadley/rvest"><strong>rvest</strong></a>, and how I used this package to ha<strong>rvest</strong> data on helminth parasites from the London Natural History Museum&#39;s <a href="http://www.nhm.ac.uk/research-curation/scientific-resources/taxonomy-systematics/host-parasites/index.html">helminth database</a>. </p>

<p>The package is called <code>parasiteR</code>, and is currently hosted by the <a href="http://ropensci.org/">ROpenSci folks</a>. The package presently has 3 main functions, with a few more on the way. These core functions obtain host-parasite interaction data based on information on host (<code>findHost()</code>), parasite (<code>findParasite()</code>), or location (<code>findLocation()</code>). </p>

<p>I&#39;ll start with an example. The code below finds all host parasite associations for <em>Gorilla gorilla</em>.</p>
<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#Install the package</span>
<span class="c1">#devtools::install_github(&#39;ropensci/parasiteR&#39;)</span>

<span class="kn">library</span><span class="p">(</span>parasiteR<span class="p">)</span>
gorillaParasites<span class="o">=</span>findHost<span class="p">(</span><span class="s">&#39;Gorilla&#39;</span><span class="p">,</span> <span class="s">&#39;gorilla&#39;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>gorillaParasites<span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">##                       Host               Parasite
## 1          Gorilla gorilla              Strongyle
## 2 Gorilla gorilla beringei              Strongyle
## 3          Gorilla gorilla          Strongyloidea
## 4          Gorilla gorilla     Trichostrongylidae
## 5          Gorilla gorilla Anoplocephala gorillae
## 6 Gorilla gorilla beringei Anoplocephala gorillae
##                           ParasiteFull
## 1                         (Strongyle) 
## 2                         (Strongyle) 
## 3                     (Strongyloidea) 
## 4                (Trichostrongylidae) 
## 5 Anoplocephala gorillae Nybelin, 1928
## 6 Anoplocephala gorillae Nybelin, 1928
</code></pre></div>
<p><img src="http://www.theanimalfiles.com/images/western_gorilla_3.jpg"  height="300" width="400"></img></p>

<p>Now we have a list of parasites recorded on <em>G. gorilla</em>. How did we get there? Really easily.</p>

<p>First, we have to get the appropriate <code>url</code>. We do this by inserting the host genus and species into the appropriate spots on the <code>url</code>, and then pulling that html object into R.  </p>
<div class="highlight"><pre><code class="language-r" data-lang="r"> hpUrl <span class="o">&lt;-</span> html<span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;http://www.nhm.ac.uk/research-curation/scientific-resources/taxonomy-systematics/host-parasites/database/results.jsp?dbfnsRowsPerPage=50000&amp;x=13&amp;y=5&amp;paragroup=&amp;fmsubgroup=Starts+with&amp;subgroup=&amp;fmparagenus=Starts+with&amp;paragenus=&amp;fmparaspecies=Starts+with&amp;paraspecies=&amp;fmhostgenus=Contains&amp;hostgenus=&quot;</span><span class="p">,</span> genus<span class="p">,</span> <span class="s">&quot;&amp;fmhostspecies=Contains&amp;hostspecies=&quot;</span><span class="p">,</span> species<span class="p">,</span> <span class="s">&quot;&amp;location=&quot;</span><span class="p">,</span> location<span class="p">,</span> <span class="s">&quot;&amp;hstate=&amp;pstatus=&amp;showparasites=on&amp;showhosts=on&amp;showrefs=on&amp;groupby=parasite&amp;search=Search&quot;</span><span class="p">,</span> sep <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
</code></pre></div>
<p>Once we have the url, we need to extract the pertinent information. This is where the <code>rvest</code> package comes in handy, as we can extract the text (<code>html_text()</code>) under certain html tags (<code>.searchlink</code>).  </p>
<div class="highlight"><pre><code class="language-r" data-lang="r"> names <span class="o">&lt;-</span> hpUrl <span class="o">%&gt;%</span>
                    html_nodes<span class="p">(</span><span class="s">&quot;.searchlink&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
                    html_text<span class="p">()</span>
</code></pre></div>
<p>After a bit more formatting, we have a matrix of host-parasite associations. This is a simple application of <code>rvest</code>, and <code>parasiteR</code> uses only a tiny bit of the functionality of <code>rvest</code>. In the coming months, I plan to incorporate some data formatting and plotting functions, but the core functionality of the package is there. </p>

<p>Feel free to check out and contribute to <a href="www.github.com/ropensci/parasiteR">parasiteR</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/20/Spotify/">
        Spotify + R = <3
      </a>
    </h1>

    <span class="post-date">20 Jan 2015</span>

    <p>If I&#39;m in the lab, I most likely have my headphones on. There is <a href="https://github.com/taddallas">documented evidence of this</a>. I remember when Spotify Apps first became a think, and I thought it was really cool that Spotify had an API, so you could query related artists and such pretty easily. This post is about some fun Spotify querying through R!</p>

<h2>The problem</h2>

<p>I initially got excited about the idea of the &quot;Nickelback number&quot;, which would be a Spotify App that calculate the degrees of separation between an input artist and the Canadian rock band <a href="http://en.wikipedia.org/wiki/Nickelback">Nickelback</a>. However, that turned out to require a bit too much work, and it felt a little mean towards the Canadian <strong>pop</strong> rockers. Instead, the point of this blog post is to show how to access Spotify&#39;s API (Application Program Interface) for some fun!</p>

<h2>Why is this problem non-trivial?</h2>

<p>It is pretty trivial, to be honest. However, learning how to query API&#39;s may be generally useful to ecologists. If you need examples, check out some of the great packages at <a href="http://ropensci.org/">rOpenSci</a>! </p>

<h2>What I did</h2>

<p>All code is available as part of the <code>rSpotify</code> package available on my <a href="http://github.com/taddallas">Github</a>. The package is bare bones, but has some cool plotting functions using the <code>d3Network</code> package. </p>

<p>Information on artists can be obtained by using the following base URL.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">https<span class="o">://</span>api.spotify.com<span class="o">/</span>v1<span class="o">/</span>artists<span class="o">/</span>ARTISTID</code></pre></div>

<p>ARTISTID is the Spotify code for an artist. You can access that code using the <code>RCurl</code> and <code>jsonlite</code> packages. Below, I access the API using the <code>getURL</code> function, and fromJSON parses JSON objects into R. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">artistName<span class="o">=</span><span class="s">&quot;The Mountain Goats&quot;</span>

  info<span class="o">=</span>fromJSON<span class="p">(</span>getURL<span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;https://api.spotify.com/v1/search?q=&quot;</span><span class="p">,</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> artistName<span class="p">),</span><span class="s">&quot;&amp;type=artist&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)))</span><span class="o">$</span>artists<span class="o">$</span>items</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: could not find function &quot;fromJSON&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">name<span class="o">=</span>info<span class="o">$</span>name<span class="p">[</span><span class="m">1</span><span class="p">]</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;info&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">id<span class="o">=</span><span class="kp">unlist</span><span class="p">(</span><span class="kp">strsplit</span><span class="p">(</span>info<span class="o">$</span>uri<span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="s">&#39;:&#39;</span><span class="p">))[</span><span class="m">3</span><span class="p">]</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;info&#39; not found</code></pre></div>

<p>Now we have the artists name and their Spotify URI, a unique artist identifier. From this, we can get information about how many followers they have, their popularity score, band image urls, and related artists.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">site<span class="o">=</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;https://api.spotify.com/v1/artists/&quot;</span><span class="p">,</span>id<span class="p">,</span><span class="s">&quot;/related-artists&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;id&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">bandsInfo<span class="o">=</span><span class="kp">as.data.frame</span><span class="p">(</span>fromJSON<span class="p">(</span>getURL<span class="p">(</span>site<span class="p">,</span> httpheader <span class="o">=</span> <span class="kt">c</span><span class="p">(</span>Accept <span class="o">=</span> <span class="s">&quot;application/json&quot;</span><span class="p">))))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: could not find function &quot;fromJSON&quot;</code></pre></div>

<p>This <code>bandsInfo</code> object contains information on 20 artists related to the original query (&quot;The Mountain Goats&quot;). Using this tiny dataset, we can explore relationships like the one between the number of artist followers, and the popularity score (which is calculated based on the number of plays per some unit time). </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span><span class="kp">unlist</span><span class="p">(</span>bandsInfo<span class="p">[,</span><span class="m">2</span><span class="p">])[</span><span class="m">21</span><span class="o">:</span><span class="m">40</span><span class="p">],</span> bandsInfo<span class="p">[,</span><span class="m">8</span><span class="p">],</span> ylab<span class="o">=</span><span class="s">&#39;Popularity&#39;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;Number of followers&#39;</span><span class="p">,</span> las<span class="o">=</span><span class="m">1</span><span class="p">,</span> pch<span class="o">=</span><span class="m">16</span><span class="p">,</span> tck<span class="o">=</span><span class="m">0.01</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;bandsInfo&#39; not found</code></pre></div>

<p>Looks cool. Now let&#39;s look at how Nickelback compares. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">awfulBand<span class="o">=</span><span class="s">&quot;Nickelback&quot;</span>

  awfulBandInfo<span class="o">=</span>fromJSON<span class="p">(</span>getURL<span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;https://api.spotify.com/v1/search?q=&quot;</span><span class="p">,</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> awfulBand<span class="p">),</span><span class="s">&quot;&amp;type=artist&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)))</span><span class="o">$</span>artists</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: could not find function &quot;fromJSON&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">awfulPop<span class="o">=</span>awfulBandInfo<span class="o">$</span>items<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">8</span><span class="p">]</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;awfulBandInfo&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">awfulFollowers<span class="o">=</span><span class="kp">unlist</span><span class="p">(</span>awfulBandInfo<span class="o">$</span>items<span class="p">[,</span><span class="m">2</span><span class="p">])[</span><span class="m">6</span><span class="p">]</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;awfulBandInfo&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span><span class="kp">unlist</span><span class="p">(</span>bandsInfo<span class="p">[,</span><span class="m">2</span><span class="p">])[</span><span class="m">21</span><span class="o">:</span><span class="m">40</span><span class="p">],</span> bandsInfo<span class="p">[,</span><span class="m">8</span><span class="p">],</span> ylab<span class="o">=</span><span class="s">&#39;Popularity&#39;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;Number of followers&#39;</span><span class="p">,</span> las<span class="o">=</span><span class="m">1</span><span class="p">,</span> pch<span class="o">=</span><span class="m">16</span><span class="p">,</span> tck<span class="o">=</span><span class="m">0.01</span><span class="p">,</span> xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">15000</span><span class="p">,</span><span class="m">1100000</span><span class="p">),</span> ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">45</span><span class="p">,</span> <span class="m">90</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;bandsInfo&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">points<span class="p">(</span>awfulFollowers<span class="p">,</span> awfulPop<span class="p">,</span> pch<span class="o">=</span><span class="m">15</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">2</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;awfulFollowers&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">text<span class="p">(</span><span class="m">1004000</span><span class="p">,</span> <span class="m">80</span><span class="p">,</span> <span class="s">&quot;Nickelback!&quot;</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">1.5</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: plot.new has not been called yet</code></pre></div>

<p>Looks like Nickelback dominates The Mountain Goats, and all of their related artists, including Athens favorites Of Montreal! Sad day, but it&#39;s understandable. I hope this has been fun for you. To conclude the post, and put things right with the universe, I&#39;d like to show Katy Perry as a dark horse, destroying Nickelback in popularity and followers. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">KP<span class="o">=</span>fromJSON<span class="p">(</span>getURL<span class="p">(</span><span class="kp">paste</span><span class="p">(</span><span class="s">&quot;https://api.spotify.com/v1/search?q=&quot;</span><span class="p">,</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&quot;Katy Perry&quot;</span><span class="p">),</span><span class="s">&quot;&amp;type=artist&quot;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)))</span><span class="o">$</span>artists</code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: could not find function &quot;fromJSON&quot;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">kpPop<span class="o">=</span>KP<span class="o">$</span>items<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">8</span><span class="p">]</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;KP&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">kpFollowers<span class="o">=</span><span class="kp">unlist</span><span class="p">(</span>KP<span class="o">$</span>items<span class="p">[,</span><span class="m">2</span><span class="p">])[</span><span class="m">21</span><span class="p">]</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;KP&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">plot<span class="p">(</span><span class="kp">unlist</span><span class="p">(</span>bandsInfo<span class="p">[,</span><span class="m">2</span><span class="p">])[</span><span class="m">21</span><span class="o">:</span><span class="m">40</span><span class="p">],</span> bandsInfo<span class="p">[,</span><span class="m">8</span><span class="p">],</span> ylab<span class="o">=</span><span class="s">&#39;Popularity&#39;</span><span class="p">,</span> xlab<span class="o">=</span><span class="s">&#39;Number of followers&#39;</span><span class="p">,</span> las<span class="o">=</span><span class="m">1</span><span class="p">,</span> pch<span class="o">=</span><span class="m">16</span><span class="p">,</span> tck<span class="o">=</span><span class="m">0.01</span><span class="p">,</span> xlim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">15000</span><span class="p">,</span><span class="m">3500000</span><span class="p">),</span> ylim<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="m">45</span><span class="p">,</span> <span class="m">90</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;bandsInfo&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">points<span class="p">(</span>awfulFollowers<span class="p">,</span> awfulPop<span class="p">,</span> pch<span class="o">=</span><span class="m">16</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">2</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;awfulFollowers&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">text<span class="p">(</span><span class="m">1004000</span><span class="p">,</span> <span class="m">80</span><span class="p">,</span> <span class="s">&quot;Nickelback!&quot;</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">1.5</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: plot.new has not been called yet</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">points<span class="p">(</span>kpFollowers<span class="p">,</span> kpPop<span class="p">,</span> pch<span class="o">=</span><span class="m">16</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;dodgerblue2&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">2</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: object &#39;kpFollowers&#39; not found</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">text<span class="p">(</span><span class="m">3000000</span><span class="p">,</span> <span class="m">85</span><span class="p">,</span> <span class="s">&quot;Katy Perry&quot;</span><span class="p">,</span> col<span class="o">=</span><span class="s">&#39;dodgerblue2&#39;</span><span class="p">,</span> cex<span class="o">=</span><span class="m">1.5</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: plot.new has not been called yet</code></pre></div>

<p>This has been a bit of a roundabout way to show how to access Spotify&#39;s API through R, but I hope it has got you thinking about accessing data from the web through API&#39;s. </p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/12/Setting-Up/">
        How we set up our blog
      </a>
    </h1>

    <span class="post-date">12 Jan 2015</span>

    <h2>The Problem</h2>

<p>John tasked me with setting up the lab blog. I&#39;ve noticed that all <a href="http://www.carlboettiger.info/">the</a> <a href="http://scottchamberlain.info/">cool</a> <a href="http://www.fromthebottomoftheheap.net/">kids</a> use Jekyll, and it seems pretty user friendly, so we decided on it. </p>

<p>The problem then became setting the site up, and allowing posts to be created in R markdown, such that <code>code</code> snippets could be run and dynamically rendered.</p>

<h2>Why this is a problem (not trivial)</h2>

<p>Lots of folks and labs host blogs, and many of these blogs might be considering switching platforms. This is a demonstration that it&#39;s pretty easy to switch over, especially if you want to write your posts in R markdown. </p>

<h2>What I did</h2>

<p>This section shouldn&#39;t be labeled what <em>I</em> did, but instead what <em>other folks</em> did. The Jekyll online community is pretty sizeable, and the answers to many issues have already been documented. The issue of blog post creation in R markdown format is one instance, as it was previously solved in <a href="http://www.jonzelner.net/jekyll/knitr/r/2014/07/02/autogen-knitr/">this helpful post</a>. </p>

<h2>How you can do it, too</h2>

<div class="highlight"><pre><code class="language-r" data-lang="r">poisson<span class="o">=</span>rpois<span class="p">(</span><span class="m">5000</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
hist<span class="p">(</span>poisson<span class="p">,</span> col<span class="o">=</span><span class="s">&#39;dodgerblue1&#39;</span><span class="p">,</span> las<span class="o">=</span><span class="m">1</span><span class="p">,</span> tck<span class="o">=</span><span class="m">0.01</span><span class="p">,</span> main<span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span></code></pre></div>

<p><img src="/../figs/2015-1-12-Setting-Up/unnamed-chunk-1.png" alt="center"> </p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2015/01/11/example-post/">
        Example post
      </a>
    </h1>

    <span class="post-date">11 Jan 2015</span>

    <p>This document will serve as both a template for blog post structure, and as a &quot;how-to&quot; for Drake lab members wanting to contribute blog posts. </p>

<h2>The problem I had to solve</h2>

<div class="message">
  Insert problem here. Markdown syntax won't work in here, since it's treating it like html. Here, the problem I'm solving is figuring out how to contribute a post to the blog. 
</div>

<h2>Why this is a problem (not trivial)</h2>

<p>This is a non-trivial problem, since all members of the Drake lab should be able to contribute blog posts if they choose. In our case, we&#39;re using Jekyll, and hosting the project on Github. <code>DrakeLab</code> is an organization, and you can ask permission to join the organization once you sign up for GitHub. For a tutorial on how to use GitHub generally, look <a href="http://github.com/taddallas/githubTutorial">here</a>. Clone the <a href="http://github.com/DrakeLab/DrakeLab.github.io">repository</a>, and get ready to contribute.</p>

<h2>Why this is generic</h2>

<p>This is a problem encountered by anyone wanting to post on our blog, but also is applicable to other folks wanting to use Jekyll and R markdown to generate blog posts. </p>

<h2>What I did</h2>

<p>The <a href="http://github.com/DrakeLab/DrakeLab.github.io">repository</a> has a bunch of folders. The only ones that you&#39;ll really need to worry about are <code>_knitr</code> and <code>tags</code>. You will write your posts as <code>.Rmd</code> files, and name them with the date (e.g., `2015-2-14-Valentines-Day.Rmd&#39; would be a romantic post). The part after the date is just to provide a brief bit about what the post is about.</p>

<p>Posts have a yaml heading that needs to be used. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">---</span>
layout<span class="o">:</span> post 
title<span class="o">:</span> Example post
author<span class="o">:</span> tad
tags<span class="o">:</span>
<span class="o">-</span> How<span class="o">-</span>to
<span class="o">---</span></code></pre></div>

<p>Above provides the details. <code>layout</code> will always be &quot;post&quot;. Provide your post title. If you are posting for the first time, chat with me about getting yourself listed as an author, or you can edit the <code>_data/authors.yaml</code> file with your information. Tags work in the following way. They&#39;ll easy to use, but for every new tag you use, you&#39;ll have to create a folder in the <code>tags</code> folder with the tag name, and a file called <code>index.html</code> containing a simple 2 line yaml stating what your tag name is and specifying the <code>layout</code> as &quot;tagpage&quot;. I know it&#39;s silly, but whatever. It works for now. </p>

<p>Proceed to write your awesome blog post, complete with reproducible and dynamically inserted plots and such. Below, I make a quick plot of an interaction matrix using the <code>metacom</code> package. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span>metacom<span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: there is no package called &#39;metacom&#39;</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r">Imagine<span class="p">(</span><span class="kt">matrix</span><span class="p">(</span>rbinom<span class="p">(</span><span class="m">400</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.4</span><span class="p">),</span> ncol<span class="o">=</span><span class="m">20</span><span class="p">,</span>nrow<span class="o">=</span><span class="m">20</span><span class="p">))</span></code></pre></div>

<div class="highlight"><pre><code class="language-text" data-lang="text">## Error: could not find function &quot;Imagine&quot;</code></pre></div>

<p>Feel free to mix a bit of <code>html</code> in with your markdown if you&#39;re feeling frisky. Below, I use the <code>img</code> html tag to include a picture of a Turkish van cat. </p>

<p><img src="http://upload.wikimedia.org/wikipedia/commons/2/22/Turkish_Van_Cat.jpg" height="300"> Cat. </img></p>

<p>Here&#39;s the annoying part. Once you finish your post, you&#39;ll have to convert it to an <code>md</code> file and put it in the <code>_posts</code> directory. I&#39;ve semi-automated this process using some code from <a href="http://www.jonzelner.net/jekyll/knitr/r/2014/07/02/autogen-knitr/">this helpful post</a>. All you&#39;ll need to do is source <code>_knitr/render_post.R</code> in an R instance. That will convert all <code>Rmd</code> posts to <code>md</code> and move them to the <code>_posts</code> folder and any figures created into the <code>figs</code> folder. Once that&#39;s done, you can push your changes. If you find it annoying or too time-consuming to rebuild all posts from <code>Rmd</code> to <code>md</code>, you can just open the <code>render_post.R</code> file and run the <code>KnitPost</code> function on a single post instead of all posts. Easy.</p>

<p>If you&#39;d like to view your post locally, you&#39;ll need to set up Jekyll on your machine. Pretty easy to set up, and if you have Ruby gems installed. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">gem install jekyll
cd USERNAME.github.com 
jekyll serve</code></pre></div>

<p>After this, use your browser to check out <a href="http://localhost:4000/">http://localhost:4000/</a> where the blog will be locally live. </p>

<p>Okay. So you&#39;ve written a blog post, sandboxed it on your local machine and are ready for it to go live. Simply <code>add</code>, <code>commit</code>, and <code>push</code> your changes to the <a href="http://github.com/DrakeLab/DrakeLab.github.io">repository</a>, and your set. </p>

<div class="highlight"><pre><code class="language-r" data-lang="r">cd USERNAME.github.com
git add <span class="m">.</span>
git commit <span class="o">-</span>m <span class="s">&quot;SOME HELPFUL MESSAGE&quot;</span>
git push origin master</code></pre></div>

<p>Enter in your <code>username</code> and <code>password</code> and you have just created a beautiful blog post full of reproducible code. </p>

<h2>How you can do it, too</h2>

<p>I just told you how to do it, silly. For fun, I&#39;ve also added in some <code>Font-Awesome</code> capabilities, so you have access to a <a href="http://fortawesome.github.io/Font-Awesome/icons/">beautiful library of icons</a> which are really easy to input. </p>

<p>For instance, let&#39;s say I want to make a tree icon. Simple.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&lt;</span>i class<span class="o">=</span><span class="s">&quot;fa fa-tree&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span>i<span class="o">&gt;</span></code></pre></div>

<p><i class="fa fa-tree"> </i></p>

<p>Let&#39;s say I want the tree to be like 2,3,4,or 5x larger.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&lt;</span>i class<span class="o">=</span><span class="s">&quot;fa fa-tree fa-2x&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span>i<span class="o">&gt;</span>
<span class="o">&lt;</span>i class<span class="o">=</span><span class="s">&quot;fa fa-tree fa-3x&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span>i<span class="o">&gt;</span>
<span class="o">&lt;</span>i class<span class="o">=</span><span class="s">&quot;fa fa-tree fa-4x&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span>i<span class="o">&gt;</span>
<span class="o">&lt;</span>i class<span class="o">=</span><span class="s">&quot;fa fa-tree fa-5x&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span>i<span class="o">&gt;</span></code></pre></div>

<p><i class="fa fa-tree fa-2x"> </i>
<i class="fa fa-tree fa-3x"> </i>
<i class="fa fa-tree fa-4x"> </i>
<i class="fa fa-tree fa-5x"> </i></p>

<p>What if I want the tree to be green?</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&lt;</span>i class<span class="o">=</span><span class="s">&quot;fa fa-tree&quot;</span> style<span class="o">=</span><span class="s">&quot;color:green&quot;</span><span class="o">&gt;</span> <span class="o">&lt;/</span>i<span class="o">&gt;</span></code></pre></div>

<p><i class="fa fa-tree" style="color:green"> </i></p>

<p>Thanks for reading. I hope you decide to contribute to this blog, and that other folks find this blog useful. </p>

<p><i class="fa fa-heart" style="color:pink"> </i></p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>
    </div>

  </body>
</html>
